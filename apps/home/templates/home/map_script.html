<div class="customJs">
    <script type="text/javascript">
        var coordsList = [];
        {% for job in jobs %}
        coordsList.push([{{job.location.latitude}}, {{job.location.longitude}}]);
        {% endfor %}

        var mymap = L.map('mapid').setView({{ location.coordinates }}, 15);
        L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
            attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
            maxZoom: 18,
            id: 'mapbox.streets',
            accessToken: '{{ api_key }}'
        }).addTo(mymap);
        addPins();

        function addPins() {
          for(var i = 0; i < coordsList.length; i++) {
            L.marker(coordsList[i]).addTo(mymap);
          }
        }
    </script>
    <script type="text/javascript">
    //Add event listeners for these two variables
    $('#search-neighborhood').on('submit', function(event){
      console.log("form submitted!");  // sanity check
      //run the /search/ route when renderMapButton is activated
      var newCoordinates = retrieveCoordinates();
      event.preventDefault();
      //update the map with the new coordinates
      updateMapCoordinates(newCoordinates);
      return false;
    });

    function retrieveCoordinates(){
      var coordinates = "";
      console.log("retrieving coordinates...");
      $.ajax({
        url: $('#search-neighborhood')[0].action,
        type: "GET",
        data: {query: $("#select-neighborhood").val()},

        // handle a successful response
        success: function(json){
          console.log("success!");
          coordinates = json;
          console.log(coordinates); //log the returned json to the console
        },

        //handle a failure
        error: function(xhr, errmsg, err) {
          console.log(xhr.status + ": " + xhr.responseText);
        }
      });
      return coordinates;
    }

    function updateMapCoordinates(newCoordinates){
      mymap.setView(newCoordinates, 15);
      return true;
    }
    </script>
</div>
